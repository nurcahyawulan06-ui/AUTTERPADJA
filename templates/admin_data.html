{% extends "base.html" %}
{% block title %}Admin Data - Semua Analisis{% endblock %}
{% block content %}
<h1 class="text-danger mb-4">Akses Admin: Semua Data Analisis ðŸ”‘</h1>
<p class="lead">Halaman ini menampilkan semua data kalkulasi Tebu, Jagung, dan Padi dari seluruh pengguna ({{ tebu|length + jagung|length + padi|length }} total entri).</p>

<div class="row mb-5">
    <div class="col-md-4">
        <div class="card text-white bg-success shadow">
            <div class="card-body">
                <h5 class="card-title">Total Netto Tebu</h5>
                <p class="card-text fs-4">Rp {{ "{:,.0f}".format(total_tebu) }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-warning shadow">
            <div class="card-body">
                <h5 class="card-title">Total Netto Jagung</h5>
                <p class="card-text fs-4">Rp {{ "{:,.0f}".format(total_jagung) }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-info shadow">
            <div class="card-body">
                <h5 class="card-title">Total Netto Padi</h5>
                <p class="card-text fs-4">Rp {{ "{:,.0f}".format(total_padi) }}</p>
            </div>
        </div>
    </div>
</div>

<ul class="nav nav-tabs" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="tebu-tab" data-bs-toggle="tab" data-bs-target="#tebu" type="button" role="tab" aria-controls="tebu" aria-selected="true">Data Tebu ({{ tebu|length }})</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="jagung-tab" data-bs-toggle="tab" data-bs-target="#jagung" type="button" role="tab" aria-controls="jagung" aria-selected="false">Data Jagung ({{ jagung|length }})</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="padi-tab" data-bs-toggle="tab" data-bs-target="#padi" type="button" role="tab" aria-controls="padi" aria-selected="false">Data Padi ({{ padi|length }})</button>
    </li>
</ul>

<div class="tab-content border border-top-0 p-3 bg-light" id="myTabContent">
    
    <div class="tab-pane fade show active" id="tebu" role="tabpanel" aria-labelledby="tebu-tab">
        <h4 class="mt-3 text-success">Detail Analisis Tebu</h4>
        {% if tebu %}
        <div class="table-responsive">
            <table class="table table-sm table-bordered table-hover">
                <thead class="table-success">
                    <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Lokasi</th>
                        <th>Luas Kebun (Ha)</th>
                        <th>Protas Kebun (Kg)</th>
                        <th>Biaya (Rp)</th>
                        <th>Netto (Rp)</th>
                        <th>Waktu</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in tebu %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>{{ item.user.name }} ({{ item.user_id }})</td>
                        <td>{{ item.lokasi_sawah }}</td>
                        <td class="text-end">{{ "{:,.2f}".format(item.luas_kebun) }}</td>
                        <td class="text-end">{{ "{:,.2f}".format(item.protas_tebu_kebun) }}</td>
                        <td class="text-end">Rp {{ "{:,.0f}".format(item.harga_perawatan_total) }}</td>
                        <td class="text-end fw-bold text-{{ 'success' if item.nilai_netto > 0 else 'danger' }}">Rp {{ "{:,.0f}".format(item.nilai_netto) }}</td>
                        <td>{{ item.timestamp.strftime('%Y-%m-%d') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-center text-muted mt-4">Belum ada data analisis Tebu yang tersimpan.</p>
        {% endif %}
    </div>

    <div class="tab-pane fade" id="jagung" role="tabpanel" aria-labelledby="jagung-tab">
        <h4 class="mt-3 text-warning">Detail Analisis Jagung</h4>
        {% if jagung %}
        <div class="table-responsive">
            <table class="table table-sm table-bordered table-hover">
                <thead class="table-warning">
                    <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Lokasi</th>
                        <th>Varietas</th>
                        <th>Protas (Kg)</th>
                        <th>Biaya (Rp)</th>
                        <th>Netto (Rp)</th>
                        <th>Waktu</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in jagung %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>{{ item.user.name }} ({{ item.user_id }})</td>
                        <td>{{ item.lokasi_sawah }}</td>
                        <td>{{ item.varietas }}</td>
                        <td class="text-end">{{ "{:,.2f}".format(item.protas_jagung_kering_kg) }}</td>
                        <td class="text-end">Rp {{ "{:,.0f}".format(item.biaya_kebun) }}</td>
                        <td class="text-end fw-bold text-{{ 'success' if item.nilai_protas_netto > 0 else 'danger' }}">Rp {{ "{:,.0f}".format(item.nilai_protas_netto) }}</td>
                        <td>{{ item.timestamp.strftime('%Y-%m-%d') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-center text-muted mt-4">Belum ada data analisis Jagung yang tersimpan.</p>
        {% endif %}
    </div>
    
    <div class="tab-pane fade" id="padi" role="tabpanel" aria-labelledby="padi-tab">
        <h4 class="mt-3 text-info">Detail Analisis Padi</h4>
        {% if padi %}
        <div class="table-responsive">
            <table class="table table-sm table-bordered table-hover">
                <thead class="table-info">
                    <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Lokasi</th>
                        <th>Varietas</th>
                        <th>Protas (Kg)</th>
                        <th>Biaya (Rp)</th>
                        <th>Netto (Rp)</th>
                        <th>Waktu</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in padi %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>{{ item.user.name }} ({{ item.user_id }})</td>
                        <td>{{ item.lokasi_sawah }}</td>
                        <td>{{ item.varietas }}</td>
                        <td class="text-end">{{ "{:,.2f}".format(item.protas_padi_kg) }}</td>
                        <td class="text-end">Rp {{ "{:,.0f}".format(item.biaya_kebun) }}</td>
                        <td class="text-end fw-bold text-{{ 'success' if item.nilai_protas_netto > 0 else 'danger' }}">Rp {{ "{:,.0f}".format(item.nilai_protas_netto) }}</td>
                        <td>{{ item.timestamp.strftime('%Y-%m-%d') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-center text-muted mt-4">Belum ada data analisis Padi yang tersimpan.</p>
        {% endif %}
    </div>

</div>
{% endblock %}